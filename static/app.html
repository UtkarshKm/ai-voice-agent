<!DOCTYPE html>
<html
    lang="en"
    class="h-full"
>
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0"
        />
        <title>Dhwani - AI Voice Agent</title>

        <meta
            name="description"
            content="Dhwani - A conversational AI voice agent that listens to your questions and responds in a natural voice."
        />
        <meta
            name="keywords"
            content="AI, voice assistant, speech recognition, voice chat, conversational AI"
        />
        <meta
            name="author"
            content="Utkarsh Kumawat"
        />

        <meta
            name="theme-color"
            content="#6366f1"
        />
        <meta
            name="apple-mobile-web-app-capable"
            content="yes"
        />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="default"
        />
        <meta
            name="apple-mobile-web-app-title"
            content="AI Voice Agent"
        />

        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            primary: "#667eea",
                            secondary: "#764ba2",
                            accent: "#f093fb",
                            "accent-end": "#f5576c",
                        },
                    },
                },
            };
        </script>

        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

        <meta
            name="color-scheme"
            content="light dark"
        />

        <style>
            /* Enhanced Custom Styles */
            body {
                background: #1a1a2e;
                min-height: 100vh;
            }

            .glass-card {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 25px 45px rgba(0, 0, 0, 0.1);
            }

            .gradient-text {
                color: #667eea;
            }

            .pulse-ring {
                animation: pulse-ring-animation 2s infinite;
            }

            @keyframes pulse-ring-animation {
                0% {
                    transform: scale(0.9);
                    box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
                }
                70% {
                    transform: scale(1.05);
                    box-shadow: 0 0 0 20px rgba(102, 126, 234, 0);
                }
                100% {
                    transform: scale(0.9);
                    box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
                }
            }

            .recording-animation {
                animation: recording-pulse 1s infinite;
            }

            @keyframes recording-pulse {
                0%,
                100% {
                    transform: scale(1);
                    background: #f093fb;
                }
                50% {
                    transform: scale(1.1);
                    background: #f5576c;
                }
            }

            .conversation-scroll {
                scroll-behavior: smooth;
                scrollbar-width: thin;
                scrollbar-color: rgba(102, 126, 234, 0.3) transparent;
            }

            .conversation-scroll::-webkit-scrollbar {
                width: 6px;
            }

            .conversation-scroll::-webkit-scrollbar-track {
                background: transparent;
            }

            .conversation-scroll::-webkit-scrollbar-thumb {
                background: rgba(102, 126, 234, 0.3);
                border-radius: 3px;
            }

            .conversation-scroll::-webkit-scrollbar-thumb:hover {
                background: rgba(102, 126, 234, 0.5);
            }

            /* Enhanced Chat Bubble Styles */
            .message-container {
                display: flex;
                flex-direction: column;
                animation: slideIn 0.3s ease-out;
            }

            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translateY(10px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .message-bubble {
                padding: 1rem 1.5rem;
                border-radius: 1.5rem;
                max-width: 85%;
                word-wrap: break-word;
                line-height: 1.6;
                position: relative;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }

            .message-bubble strong {
                font-weight: 600;
            }

            .user-message {
                background: #667eea;
                color: black;
                align-self: flex-end;
                border-bottom-right-radius: 0.5rem;
            }

            .ai-message {
                background: rgba(255, 255, 255, 0.9);
                color: black;
                align-self: flex-start;
                border-bottom-left-radius: 0.5rem;
                backdrop-filter: blur(10px);
            }

            .error-message {
                background: #fecaca;
                color: #991b1b;
                align-self: center;
                text-align: center;
            }

            /* Enhanced Button Styles */
            .btn-primary {
                background: #667eea;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }

            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
            }

            .btn-gradient {
                background: #f093fb;
                transition: all 0.3s ease;
            }

            .btn-gradient:hover {
                transform: translateY(-1px);
                box-shadow: 0 8px 20px rgba(240, 147, 251, 0.4);
            }

            /* Settings Modal Enhancement */
            #settings-modal.hidden {
                display: none;
            }

            .modal-backdrop {
                background: rgba(0, 0, 0, 0.6);
                backdrop-filter: blur(5px);
            }

            .modal-content {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(20px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
            
            /* Floating particles animation */
            .floating-particles {
                position: absolute;
                width: 100%;
                height: 100%;
                overflow: hidden;
                pointer-events: none;
            }

            .particle {
                position: absolute;
                width: 4px;
                height: 4px;
                background: rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                animation: float 15s infinite linear;
            }

            @keyframes float {
                0% {
                    transform: translateY(100vh) translateX(0);
                    opacity: 0;
                }
                10% {
                    opacity: 1;
                }
                90% {
                    opacity: 1;
                }
                100% {
                    transform: translateY(-100px) translateX(100px);
                    opacity: 0;
                }
            }

            .particle:nth-child(1) {
                left: 10%;
                animation-delay: 0s;
            }
            .particle:nth-child(2) {
                left: 20%;
                animation-delay: 2s;
            }
            .particle:nth-child(3) {
                left: 30%;
                animation-delay: 4s;
            }
            .particle:nth-child(4) {
                left: 40%;
                animation-delay: 6s;
            }
            .particle:nth-child(5) {
                left: 50%;
                animation-delay: 8s;
            }
            .particle:nth-child(6) {
                left: 60%;
                animation-delay: 10s;
            }
            .particle:nth-child(7) {
                left: 70%;
                animation-delay: 12s;
            }
            .particle:nth-child(8) {
                left: 80%;
                animation-delay: 14s;
            }
            .particle:nth-child(9) {
                left: 90%;
                animation-delay: 16s;
            }

            /* Enhanced form inputs */
            .enhanced-input {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                transition: all 0.3s ease;
            }

            .enhanced-input:focus {
                background: rgba(255, 255, 255, 0.15);
                border-color: rgba(102, 126, 234, 0.5);
                box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            }
            
             /* FIX: Ensure dropdown text is black */
            #persona-select,
            #persona-select option {
                color: black;
            }

            /* Status indicators */
            .status-online {
                background: #10b981;
                box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
            }

            .status-offline {
                background: #ef4444;
                box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
            }
        </style>
    </head>
    <body class="h-full text-white antialiased relative overflow-hidden">
        <div class="floating-particles fixed inset-0 z-0">
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
            <div class="particle"></div>
        </div>

        <div
            id="app"
            class="min-h-full flex items-center justify-center p-4 sm:p-6 relative z-10"
        >
            <div class="w-full max-w-4xl">
                <div
                    class="glass-card rounded-3xl shadow-2xl ring-1 ring-white/20 overflow-hidden"
                >
                    <header class="px-6 sm:px-8 py-6 border-b border-white/10">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-4">
                                <div
                                    class="w-12 h-12 rounded-xl bg-purple-600 flex items-center justify-center text-2xl"
                                >
                                    🎙️
                                </div>
                                <div>
                                    <h1 class="text-2xl font-bold gradient-text">Dhwani</h1>
                                    <p class="text-white/70 text-sm font-medium">
                                        Resonate. Respond.
                                    </p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-4">
                                <button
                                    id="new-chat-button"
                                    class="px-4 py-2 bg-white/10 hover:bg-white/20 backdrop-filter backdrop-blur-sm rounded-xl text-sm font-medium transition-all duration-300 hover:scale-105"
                                    aria-label="Start a new chat"
                                >
                                    New Chat
                                </button>
                                <button
                                    id="settings-button"
                                    class="px-4 py-2 bg-white/10 hover:bg-white/20 backdrop-filter backdrop-blur-sm rounded-xl text-sm font-medium transition-all duration-300 hover:scale-105"
                                    aria-label="Open settings"
                                >
                                    Settings
                                </button>
                                <a
                                    href="https://github.com/UtkarshKm"
                                    target="_blank"
                                    class="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-xl text-sm font-medium transition-all duration-300 hover:scale-105"
                                >
                                    Built by Utkarsh
                                </a>
                            </div>
                        </div>
                    </header>

                    <div class="px-6 sm:px-8 py-6 border-b border-white/10">
                        <label
                            for="persona-select"
                            class="block text-sm font-semibold text-white/90 mb-3"
                            >Choose a Persona:</label
                        >
                        <select
                            id="persona-select"
                            name="persona"
                            class="block w-full pl-4 pr-10 py-3 text-base border-0 focus:outline-none focus:ring-2 focus:ring-purple-500 rounded-xl enhanced-input"
                        >
                            <option value="default">Helpful Assistant</option>
                            <option value="default_verbose">Verbose Assistant</option>
                            <option value="eccentric_professor">Eccentric Professor</option>
                            <option value="dungeon_master">Dungeon Master</option>
                            <option value="sarcastic_teenager">Sarcastic Teenager</option>
                            <option value="zen_monk">Zen Monk</option>
                            <option value="noir_detective">Noir Detective</option>
                        </select>
                    </div>

                    <main id="main-content">
                        <section
                            id="llm-query-section"
                            class="p-6 sm:p-8"
                            aria-label="AI Voice Chat"
                        >
                            <div class="mb-8">
                                <div
                                    id="llmConversation"
                                    class="space-y-4 text-sm max-h-96 overflow-y-auto p-6 bg-black/10 backdrop-filter backdrop-blur-sm rounded-2xl border border-white/10 conversation-scroll"
                                    role="log"
                                    aria-label="Conversation history"
                                    aria-live="polite"
                                >
                                    <div id="transcript-container"></div>
                                </div>
                            </div>

                            <div class="text-center">
                                <div
                                    id="llmStatus"
                                    class="text-base text-white/80 min-h-6 mb-8 font-medium"
                                    role="status"
                                    aria-live="polite"
                                >
                                    Click the button to start your conversation
                                </div>

                                <button
                                    id="record-button"
                                    type="button"
                                    class="relative inline-flex items-center justify-center w-24 h-24 rounded-full bg-purple-600 text-white shadow-xl hover:shadow-2xl hover:bg-purple-700 focus:outline-none focus:ring-4 focus:ring-purple-500/50 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed pulse-ring hover:scale-110"
                                    aria-label="Start recording to ask AI"
                                >
                                    <svg
                                        class="w-10 h-10"
                                        fill="currentColor"
                                        viewBox="0 0 20 20"
                                    >
                                        <path d="M7 4a3 3 0 016 0v6a3 3 0 11-6 0V4z"></path>
                                        <path
                                            d="M5.5 11.5a.5.5 0 01.5-.5h8a.5.5 0 010 1h-8a.5.5 0 01-.5-.5z"
                                        ></path>
                                        <path
                                            d="M10 18.5a5.5 5.5 0 01-5.5-5.5V8.5a.5.5 0 011 0v4.5a4.5 4.5 0 109 0V8.5a.5.5 0 011 0v4.5A5.5 5.5 0 0110 18.5z"
                                        ></path>
                                    </svg>
                                </button>
                            </div>
                        </section>
                    </main>

                    <footer
                        class="px-6 sm:px-8 py-6 bg-black/10 border-t border-white/10"
                    >
                        <div
                            class="flex items-center justify-between text-sm text-white/70"
                        >
                            <div class="flex items-center gap-4">
                                <span
                                    class="font-mono text-white/60 bg-black/20 px-3 py-1 rounded-lg"
                                    title="Session ID"
                                >
                                    Session: <span id="session-id-display">...</span>
                                </span>
                                <span class="text-white/40">•</span>
                                <span class="flex items-center gap-1 text-white/60">
                                    Made with ❤️ by Utkarsh
                                </span>
                                <span class="text-white/40">•</span>
                                <div class="flex items-center gap-3">
                                    <a
                                        href="https://x.com/UtkKumawat"
                                        target="_blank"
                                        class="text-white/60 hover:text-white transition-colors duration-300 p-2 rounded-lg hover:bg-white/10"
                                    >
                                        <svg
                                            class="w-5 h-5"
                                            fill="currentColor"
                                            viewBox="0 0 16 16"
                                        >
                                            <path
                                                d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.601.75Zm-.86 13.028h1.36L4.323 2.145H2.865z"
                                            />
                                        </svg>
                                    </a>
                                    <a
                                        href="https://www.linkedin.com/in/utkarshkm/"
                                        target="_blank"
                                        class="text-white/60 hover:text-white transition-colors duration-300 p-2 rounded-lg hover:bg-white/10"
                                    >
                                        <svg
                                            class="w-5 h-5"
                                            fill="currentColor"
                                            viewBox="0 0 24 24"
                                        >
                                            <path
                                                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.225 0z"
                                            />
                                        </svg>
                                    </a>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <div
                                    id="health-status"
                                    class="flex items-center gap-2 text-sm"
                                >
                                    <span
                                        id="status-dot"
                                        class="inline-block h-3 w-3 rounded-full status-online"
                                    ></span>
                                    <span
                                        id="status-text"
                                        class="font-medium"
                                        >Online</span
                                    >
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
        </div>

        <div
            id="settings-modal"
            class="hidden fixed inset-0 modal-backdrop overflow-y-auto h-full w-full z-50"
        >
            <div
                class="relative top-20 mx-auto p-6 border-0 w-full max-w-lg shadow-2xl rounded-3xl modal-content"
            >
                <div class="text-center">
                    <div
                        class="flex items-center justify-center w-16 h-16 mx-auto mb-4 rounded-full bg-purple-600"
                    >
                        <svg
                            class="w-8 h-8 text-white"
                            fill="none"
                            stroke="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                            ></path>
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                            ></path>
                        </svg>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">
                        API Key Settings
                    </h3>
                    <div class="mt-4 px-2 py-3">
                        <p class="text-sm text-gray-600 mb-6">
                            Your API keys are stored locally in your browser and are never
                            sent to our servers.
                        </p>
                        <div class="space-y-6 text-left">
                            <div>
                                <label
                                    for="assemblyai-key"
                                    class="block text-sm font-semibold text-gray-700 mb-2"
                                    >AssemblyAI API Key</label
                                >
                                <input
                                    type="password"
                                    id="assemblyai-key"
                                    class="w-full px-4 py-3 enhanced-input text-black rounded-xl text-sm shadow-sm placeholder-gray-400 focus:outline-none"
                                />
                            </div>
                            <div>
                                <label
                                    for="gemini-key"
                                    class="block text-sm font-semibold text-gray-700 mb-2"
                                    >Google Gemini API Key</label
                                >
                                <input
                                    type="password"
                                    id="gemini-key"
                                    class="w-full px-4 py-3 enhanced-input rounded-xl text-black text-sm shadow-sm placeholder-gray-400 focus:outline-none"
                                />
                            </div>
                            <div>
                                <label
                                    for="murf-key"
                                    class="block text-sm font-semibold text-gray-700 mb-2"
                                    >Murf API Key</label
                                >
                                <input
                                    type="password"
                                    id="murf-key"
                                    class="w-full px-4 py-3 enhanced-input rounded-xl text-black text-sm shadow-sm placeholder-gray-400 focus:outline-none"
                                />
                            </div>
                            <div>
                                <label
                                    for="tavily-key"
                                    class="block text-sm font-semibold text-gray-700 mb-2"
                                    >Tavily API Key</label
                                >
                                <input
                                    type="password"
                                    id="tavily-key"
                                    class="w-full px-4 py-3 enhanced-input rounded-xl text-black text-sm shadow-sm placeholder-gray-400 focus:outline-none"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="px-4 py-6 space-y-3">
                        <button
                            id="save-settings-button"
                            class="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white text-base font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-purple-500/50 transition-all duration-300"
                        >
                            Save and Reload
                        </button>
                        <button
                            id="close-settings-button"
                            class="w-full px-6 py-3 bg-white/10 backdrop-filter backdrop-blur-sm text-gray-700 text-base font-medium rounded-xl hover:bg-white/20 focus:outline-none focus:ring-2 focus:ring-gray-400 transition-all duration-300"
                        >
                            Close
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div
            id="notification-container"
            class="fixed top-4 right-4 z-40 space-y-2"
            aria-live="polite"
        ></div>

        <script src="/static/app.js"></script>
    </body>
</html>